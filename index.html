<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowGrid Beacon - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîó</text></svg>">
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tweetnacl/nacl-fast.min.js"></script>
    
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        :root {
            --primary: #00f3ff;
            --secondary: #8a2be2;
            --accent-green: #00ff88;
            --accent-blue: #0099ff;
            --accent-orange: #ffaa00;
            --accent-red: #ff4444;
            --dark: #0a0a0f;
            --darker: #050508;
            --card-bg: rgba(20, 20, 30, 0.9);
            --light: #f0f0f0;
            --text-secondary: #b0b0c0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--dark);
            color: var(--light);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 153, 255, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-links a {
            color: var(--light);
            text-decoration: none;
            transition: color 0.3s;
            font-size: 0.95rem;
            position: relative;
            padding: 5px 0;
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: width 0.3s;
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        .cta-button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .cta-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 243, 255, 0.3);
        }
        
        .cta-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* –ì–µ—Ä–æ–π —Å–µ–∫—Ü–∏—è */
        .hero {
            padding: 140px 2rem 60px;
            text-align: center;
            background: linear-gradient(180deg, var(--darker) 0%, var(--dark) 100%);
        }
        
        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(45deg, var(--primary), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto 3rem;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .live-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            max-width: 900px;
            margin: 3rem auto;
        }
        
        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.8rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Beacon Connection */
        .beacon-section {
            padding: 4rem 2rem;
            background: var(--darker);
        }
        
        .section-title {
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 2rem;
            color: var(--primary);
        }
        
        .section-subtitle {
            text-align: center;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto 3rem;
        }
        
        .connection-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid rgba(0, 153, 255, 0.2);
        }
        
        .status-item {
            display: flex;
            align-items: center;
            padding: 1.2rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 3px solid #666;
            transition: all 0.3s;
        }
        
        .status-item.active {
            border-left-color: var(--accent-green);
            background: rgba(0, 255, 136, 0.05);
        }
        
        .status-item.error {
            border-left-color: var(--accent-red);
            background: rgba(255, 68, 68, 0.05);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 15px;
            background: #666;
        }
        
        .status-dot.active {
            background: var(--accent-green);
            box-shadow: 0 0 10px var(--accent-green);
        }
        
        .status-dot.error {
            background: var(--accent-red);
            box-shadow: 0 0 10px var(--accent-red);
        }
        
        /* URL Input */
        .url-input-section {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
        }
        
        .url-input {
            flex: 1;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 153, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .url-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
        }
        
        /* Protocol Display */
        .protocol-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--text-secondary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-height: 150px;
            overflow-y: auto;
        }
        
        .protocol-line {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .protocol-line.success {
            color: var(--accent-green);
        }
        
        .protocol-line.error {
            color: var(--accent-red);
        }
        
        .protocol-line.info {
            color: var(--accent-blue);
        }
        
        /* –ö–∞—Ä—Ç–∞ */
        .network-map {
            padding: 4rem 2rem;
            background: var(--dark);
        }
        
        #map-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            overflow: hidden;
            height: 400px;
            position: relative;
            border: 1px solid rgba(0, 153, 255, 0.2);
        }
        
        .node-point {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1;
        }
        
        .node-point:hover {
            width: 10px;
            height: 10px;
            z-index: 10;
        }
        
        /* –§—É—Ç–µ—Ä */
        footer {
            background: var(--darker);
            padding: 3rem 2rem;
            text-align: center;
            border-top: 1px solid rgba(0, 243, 255, 0.2);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            padding: 1rem;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            max-width: 500px;
            margin: 2rem auto;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            border: 2px solid var(--primary);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .nav-links {
                display: none;
            }
            
            .live-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
        }
        
        /* –£—Ç–∏–ª–∏—Ç—ã */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-2 { margin-top: 2rem; }
        .mb-2 { margin-bottom: 2rem; }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <header class="header">
        <nav class="nav-container">
            <a href="#" class="logo">
                <span>üîó</span>
                <span>ShadowGrid Beacon</span>
            </a>
            <div class="nav-links">
                <a href="#beacon">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</a>
                <a href="#network">–°–µ—Ç—å</a>
                <a href="#admin">–ê–¥–º–∏–Ω–∫–∞</a>
            </div>
        </nav>
    </header>

    <!-- –ì–µ—Ä–æ–π —Å–µ–∫—Ü–∏—è -->
    <section class="hero">
        <h1 class="fade-in">ShadowGrid Beacon v3.0</h1>
        <p class="hero-subtitle fade-in">
            –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Beacon —á–µ—Ä–µ–∑ URL –∏–∑ –∞–¥–º–∏–Ω–∫–∏. –†–µ–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ, –Ω–∞—Å—Ç–æ—è—â–∞—è —Å–µ—Ç—å.
        </p>
        
        <div class="live-stats">
            <div class="stat-card fade-in">
                <div class="stat-number" id="total-nodes">1,847</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —É–∑–ª–æ–≤</div>
            </div>
            <div class="stat-card fade-in">
                <div class="stat-number" id="beacons-online">3</div>
                <div class="stat-label">–ú–∞—è–∫–æ–≤ –æ–Ω–ª–∞–π–Ω</div>
            </div>
            <div class="stat-card fade-in">
                <div class="stat-number" id="handshakes">42.8K</div>
                <div class="stat-label">–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–π</div>
            </div>
            <div class="stat-card fade-in">
                <div class="stat-number" id="latency">47ms</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞</div>
            </div>
        </div>
        
        <button onclick="scrollToBeacon()" class="cta-button fade-in">
            üîó –ù–∞—á–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        </button>
    </section>

    <!-- Beacon Connection -->
    <section id="beacon" class="beacon-section">
        <h2 class="section-title">ü§ù –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Beacon</h2>
        <p class="section-subtitle">
            URL –¥–ª—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∞–¥–º–∏–Ω–∫–∏ —á–µ—Ä–µ–∑ GunDB –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä URL
        </p>
        
        <div class="connection-container">
            <!-- URL Input Section -->
            <div class="url-input-section">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">URL –¥–ª—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è</h3>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                    –í—Å—Ç–∞–≤—å—Ç–µ URL –∏–∑ –∞–¥–º–∏–Ω–∫–∏ ShadowGrid –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ GunDB
                </p>
                
                <div class="input-group">
                    <input type="text" id="beacon-url-input" class="url-input" 
                           placeholder="wss://web-production-50e5e.up.railway.app" 
                           value="wss://web-production-50e5e.up.railway.app">
                    <button onclick="useDetectedBeacon()" class="cta-button" style="white-space: nowrap;">
                        üîç –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                    </button>
                </div>
                
                <div style="margin-top: 1rem; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="loadBeaconFromURL()" class="cta-button" style="background: var(--accent-blue);">
                        üìã –ò–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ URL
                    </button>
                    <button onclick="loadBeaconFromStorage()" class="cta-button" style="background: var(--secondary);">
                        üíæ –ò–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ
                    </button>
                    <button onclick="clearBeaconURL()" class="cta-button" style="background: var(--accent-red);">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
            </div>
            
            <!-- Connection Status -->
            <div id="connection-status">
                <div class="status-item" id="status-url">
                    <div class="status-dot" id="dot-url"></div>
                    <div style="flex: 1;">
                        <div>URL Beacon –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);" id="status-url-text">
                            –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ URL...
                        </div>
                    </div>
                </div>
                
                <div class="status-item" id="status-signature">
                    <div class="status-dot" id="dot-signature"></div>
                    <div style="flex: 1;">
                        <div>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Beacon</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);" id="status-signature-text">
                            –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∞–¥–º–∏–Ω–∫–∏...
                        </div>
                    </div>
                </div>
                
                <div class="status-item" id="status-handshake">
                    <div class="status-dot" id="dot-handshake"></div>
                    <div style="flex: 1;">
                        <div>–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ (Handshake)</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);" id="status-handshake-text">
                            –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...
                        </div>
                    </div>
                </div>
                
                <div class="status-item" id="status-network">
                    <div class="status-dot" id="dot-network"></div>
                    <div style="flex: 1;">
                        <div>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);" id="status-network-text">
                            –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è P2P...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Protocol Display -->
            <div class="protocol-display" id="protocol-log">
                <div class="protocol-line info">[–°–∏—Å—Ç–µ–º–∞] ShadowGrid Beacon v3.0 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω</div>
                <div class="protocol-line info">[–°–∏—Å—Ç–µ–º–∞] –û–∂–∏–¥–∞–Ω–∏–µ URL Beacon –¥–ª—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è</div>
            </div>
            
            <!-- Action Buttons -->
            <div style="margin-top: 2rem; text-align: center;">
                <button onclick="startHandshake()" id="handshake-btn" class="cta-button" disabled>
                    üîÑ –ù–∞—á–∞—Ç—å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ
                </button>
                <button onclick="showQRCode()" class="cta-button" style="background: var(--secondary); margin-left: 1rem;">
                    üì± QR –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                </button>
            </div>
            
            <!-- Success Section -->
            <div id="success-section" class="hidden" style="margin-top: 2rem; padding: 2rem; background: rgba(0, 255, 136, 0.1); border-radius: 8px; border: 1px solid var(--accent-green); text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
                <h3 style="color: var(--accent-green); margin-bottom: 1rem;">Beacon –ø–æ–¥–∫–ª—é—á—ë–Ω!</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;" id="success-message">
                    –†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ. –í—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ —Å–µ—Ç–∏ ShadowGrid.
                </p>
                <div id="connection-details" style="text-align: left; background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                    <!-- –î–µ—Ç–∞–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
                </div>
            </div>
            
            <!-- Error Section -->
            <div id="error-section" class="hidden" style="margin-top: 2rem; padding: 1.5rem; background: rgba(255, 68, 68, 0.1); border-radius: 8px; border: 1px solid var(--accent-red);">
                <h4 style="color: var(--accent-red); margin-bottom: 0.5rem;">‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h4>
                <p id="error-message" style="color: var(--text-secondary); font-size: 0.9rem;"></p>
                <div style="margin-top: 1rem;">
                    <button onclick="retryConnection()" class="cta-button" style="background: var(--accent-red); margin-right: 10px;">
                        üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                    </button>
                    <button onclick="showDebugInfo()" class="cta-button" style="background: var(--accent-orange);">
                        üêõ –û—Ç–ª–∞–¥–∫–∞
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- –ö–∞—Ä—Ç–∞ —Å–µ—Ç–∏ -->
    <section id="network" class="network-map">
        <h2 class="section-title">üó∫Ô∏è –ê–∫—Ç–∏–≤–Ω—ã–µ Beacon –≤ —Å–µ—Ç–∏</h2>
        <p class="section-subtitle">
            –†–µ–∞–ª—å–Ω—ã–µ –º–∞—è–∫–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ GunDB
        </p>
        
        <div id="map-container">
            <!-- –¢–æ—á–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <div style="display: inline-flex; gap: 1.5rem; flex-wrap: wrap; justify-content: center;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 8px; height: 8px; background: var(--accent-blue); border-radius: 50%;"></div>
                    <span>–ê–∫—Ç–∏–≤–Ω—ã–π Beacon</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 8px; height: 8px; background: var(--accent-green); border-radius: 50%;"></div>
                    <span>–ü–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–π Beacon</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 8px; height: 8px; background: var(--accent-orange); border-radius: 50%;"></div>
                    <span>Beacon –≤ –æ–∂–∏–¥–∞–Ω–∏–∏</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 8px; height: 8px; background: var(--secondary); border-radius: 50%;"></div>
                    <span>–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π Beacon</span>
                </div>
            </div>
        </div>
    </section>

    <!-- –°–∫—Ä—ã—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∫–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ Beacon -->
    <div id="admin-tools" class="hidden" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
        <div style="background: var(--darker); padding: 1rem; border-radius: 8px; border: 1px solid var(--primary); max-width: 300px;">
            <h4 style="color: var(--primary); margin-bottom: 0.5rem;">üîê –ê–¥–º–∏–Ω–∫–∞: –ü–æ–¥–ø–∏—Å—å Beacon</h4>
            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1rem;">
                –°–∫—Ä—ã—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ Beacon —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
            </div>
            <button onclick="showAdminPanel()" class="cta-button" style="padding: 0.5rem 1rem; font-size: 0.8rem; width: 100%;">
                üìã –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∫–∏
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–¥–º–∏–Ω–∫–∏ -->
    <div id="admin-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: var(--primary);">üîê –ê–¥–º–∏–Ω–∫–∞ ShadowGrid</h2>
                <button onclick="closeModal('admin-modal')" style="background: none; border: none; color: #aaa; font-size: 1.5rem; cursor: pointer;">‚úï</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∏ –∞–¥–º–∏–Ω–∫–∏ -->
            <div style="display: flex; gap: 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 1.5rem;">
                <button id="tab-keys" class="tab-button active" onclick="switchTab('keys')" style="flex: 1; padding: 0.8rem; background: none; border: none; color: var(--primary); border-bottom: 2px solid var(--primary); cursor: pointer;">
                    üóùÔ∏è –ö–ª—é—á–∏
                </button>
                <button id="tab-sign" class="tab-button" onclick="switchTab('sign')" style="flex: 1; padding: 0.8rem; background: none; border: none; color: var(--text-secondary); border-bottom: 1px solid rgba(255,255,255,0.1); cursor: pointer;">
                    ‚úçÔ∏è –ü–æ–¥–ø–∏—Å—å Beacon
                </button>
                <button id="tab-beacons" class="tab-button" onclick="switchTab('beacons')" style="flex: 1; padding: 0.8rem; background: none; border: none; color: var(--text-secondary); border-bottom: 1px solid rgba(255,255,255,0.1); cursor: pointer;">
                    üì° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Beacon
                </button>
            </div>
            
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
            <div id="tab-content">
                <!-- –í–∫–ª–∞–¥–∫–∞ –∫–ª—é—á–µ–π -->
                <div id="tab-keys-content" class="tab-content active">
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">üîë –ö–ª—é—á–∏ –∞–¥–º–∏–Ω–∫–∏ Ed25519</h3>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary);">–°—Ç–∞—Ç—É—Å –∫–ª—é—á–µ–π:</span>
                            <span id="keys-status" style="color: var(--accent-green); font-weight: bold;">‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã</span>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">
                            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="keys-updated">—Ç–æ–ª—å–∫–æ —á—Ç–æ</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; gap: 1rem; margin-bottom: 1.5rem;">
                        <div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∞–¥–º–∏–Ω–∫–∏:</div>
                            <div id="admin-public-key" style="font-family: 'Courier New', monospace; font-size: 0.75rem; color: var(--light); background: rgba(0,0,0,0.5); padding: 0.5rem; border-radius: 4px; word-break: break-all; cursor: pointer;" onclick="copyToClipboard('admin-public-key')">
                                –ù–∞–∂–º–∏—Ç–µ "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏"
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∞–¥–º–∏–Ω–∫–∏:</div>
                            <div id="admin-private-key" style="font-family: 'Courier New', monospace; font-size: 0.75rem; color: var(--light); background: rgba(255,68,68,0.1); padding: 0.5rem; border-radius: 4px; word-break: break-all; cursor: pointer;" onclick="copyToClipboard('admin-private-key')">
                                ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="generateAdminKeys()" class="cta-button" style="flex: 1; padding: 0.5rem; font-size: 0.9rem;">
                            üóùÔ∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏
                        </button>
                        <button onclick="exportAdminKeys()" class="cta-button" style="flex: 1; padding: 0.5rem; font-size: 0.9rem; background: var(--accent-blue);">
                            üíæ –≠–∫—Å–ø–æ—Ä—Ç –∫–ª—é—á–µ–π
                        </button>
                        <button onclick="importAdminKeys()" class="cta-button" style="flex: 1; padding: 0.5rem; font-size: 0.9rem; background: var(--secondary);">
                            üì• –ò–º–ø–æ—Ä—Ç –∫–ª—é—á–µ–π
                        </button>
                    </div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ –ø–æ–¥–ø–∏—Å–∏ -->
                <div id="tab-sign-content" class="tab-content hidden">
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">‚úçÔ∏è –ü–æ–¥–ø–∏—Å—å Beacon</h3>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">URL Beacon –¥–ª—è –ø–æ–¥–ø–∏—Å–∏:</div>
                        <input type="text" id="admin-beacon-url" class="url-input" 
                               placeholder="wss://web-production-50e5e.up.railway.app" 
                               value="wss://web-production-50e5e.up.railway.app">
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∏:</div>
                        <select id="signature-duration" class="url-input" style="width: 100%;">
                            <option value="86400000">24 —á–∞—Å–∞</option>
                            <option value="604800000">7 –¥–Ω–µ–π</option>
                            <option value="2592000000">30 –¥–Ω–µ–π</option>
                            <option value="31536000000">1 –≥–æ–¥</option>
                            <option value="0">–ë–µ—Å—Å—Ä–æ—á–Ω–æ</option>
                        </select>
                    </div>
                    
                    <button onclick="adminSignBeacon()" class="cta-button" style="width: 100%; margin-bottom: 1rem; background: var(--accent-green);">
                        ‚úÖ –ü–æ–¥–ø–∏—Å–∞—Ç—å Beacon
                    </button>
                    
                    <div id="signature-result" class="hidden" style="padding: 1rem; background: rgba(0,255,136,0.1); border-radius: 8px; border: 1px solid var(--accent-green);">
                        <h4 style="color: var(--accent-green); margin-bottom: 0.5rem;">‚úÖ Beacon –ø–æ–¥–ø–∏—Å–∞–Ω!</h4>
                        <div style="font-family: 'Courier New', monospace; font-size: 0.7rem; color: var(--light); word-break: break-all; margin-bottom: 0.5rem;" id="signature-output"></div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">
                            –ü–æ–¥–ø–∏—Å—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –≤ GunDB –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ Beacon
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <h4 style="color: var(--accent-blue); margin-bottom: 0.5rem;">‚ÑπÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å:</h4>
                        <ol style="color: var(--text-secondary); font-size: 0.8rem; padding-left: 1.2rem;">
                            <li>–ê–¥–º–∏–Ω–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä—É –∫–ª—é—á–µ–π Ed25519</li>
                            <li>–ê–¥–º–∏–Ω–∫–∞ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç Beacon (URL + timestamp + session)</li>
                            <li>–ü–æ–¥–ø–∏—Å—å –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ GunDB –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</li>
                            <li>–ü–æ–¥–ø–∏—Å—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ Beacon —á–µ—Ä–µ–∑ WebSocket</li>
                            <li>Beacon –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç—å —Å —ç—Ç–æ–π –ø–æ–¥–ø–∏—Å—å—é</li>
                        </ol>
                    </div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Beacon -->
                <div id="tab-beacons-content" class="tab-content hidden">
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">üì° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Beacon</h3>
                    
                    <div style="margin-bottom: 1.5rem; max-height: 200px; overflow-y: auto;">
                        <div id="signed-beacons-list">
                            <!-- –°–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö Beacon -->
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="refreshBeaconsList()" class="cta-button" style="flex: 1; padding: 0.5rem; font-size: 0.9rem;">
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                        </button>
                        <button onclick="revokeBeaconSignature()" class="cta-button" style="flex: 1; padding: 0.5rem; font-size: 0.9rem; background: var(--accent-red);">
                            üö´ –û—Ç–æ–∑–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <div id="debug-modal" class="modal">
        <!-- ... —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... -->
    </div>
    
    <div id="qr-modal" class="modal">
        <!-- ... —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... -->
    </div>

    <script>
        // =================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===================
        const CONFIG = {
            // GunDB –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è Beacon
            gunPeers: [
                'https://gun-us.herokuapp.com/gun',
                'https://gun-eu.herokuapp.com/gun'
            ],
            
            // –ö–ª—é—á–∏ –≤ GunDB
            gunBeaconPath: 'shadowgrid/beacons',
            gunSignaturesPath: 'shadowgrid/signatures',
            gunAdminKeysPath: 'shadowgrid/admin/keys',
            
            // –û—Å–Ω–æ–≤–Ω–æ–π Beacon (–ø–µ—Ä–≤—ã–π –º–∞—è–∫ –Ω–∞ Railway)
            defaultBeaconURL: 'wss://web-production-50e5e.up.railway.app',
            
            // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–æ–¥–ø–∏—Å–∏ (24 —á–∞—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            signatureLifetime: 86400000,
        };

        // =================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===================
        let gun = null;
        let currentBeaconURL = '';
        let sessionId = generateSessionId();
        let adminKeyPair = null;
        let signedBeacons = new Map();
        let connectionState = {
            urlLoaded: false,
            signatureVerified: false,
            handshakeCompleted: false,
            networkConnected: false
        };

        // =================== –°–ò–°–¢–ï–ú–ê –ü–û–î–ü–ò–°–ò BEACON ===================
        
        // 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –∞–¥–º–∏–Ω–∫–∏
        function generateAdminKeys() {
            try {
                logProtocol('[–ê–¥–º–∏–Ω–∫–∞] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π Ed25519...', 'info');
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä—É –∫–ª—é—á–µ–π
                adminKeyPair = nacl.sign.keyPair();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                const keys = {
                    publicKey: nacl.util.encodeBase64(adminKeyPair.publicKey),
                    privateKey: nacl.util.encodeBase64(adminKeyPair.secretKey),
                    timestamp: Date.now(),
                    version: '1.0'
                };
                
                localStorage.setItem('shadowgrid_admin_keys', JSON.stringify(keys));
                
                // –ü—É–±–ª–∏–∫—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ GunDB
                if (gun) {
                    gun.get(CONFIG.gunAdminKeysPath).put({
                        publicKey: keys.publicKey,
                        timestamp: keys.timestamp,
                        version: keys.version
                    });
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateAdminKeysDisplay();
                
                logProtocol('[–ê–¥–º–∏–Ω–∫–∞] –ö–ª—é—á–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
                showNotification('üîë –ö–ª—é—á–∏ –∞–¥–º–∏–Ω–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                
                return true;
                
            } catch (error) {
                logProtocol(`[–ê–¥–º–∏–Ω–∫–∞] –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π: ${error.message}`, 'error');
                return false;
            }
        }

        // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–µ–π –∞–¥–º–∏–Ω–∫–∏
        function loadAdminKeys() {
            try {
                const savedKeys = localStorage.getItem('shadowgrid_admin_keys');
                if (savedKeys) {
                    const keys = JSON.parse(savedKeys);
                    
                    adminKeyPair = {
                        publicKey: nacl.util.decodeBase64(keys.publicKey),
                        secretKey: nacl.util.decodeBase64(keys.privateKey)
                    };
                    
                    updateAdminKeysDisplay();
                    logProtocol('[–ê–¥–º–∏–Ω–∫–∞] –ö–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage', 'success');
                    return true;
                }
            } catch (error) {
                console.error('Error loading admin keys:', error);
            }
            
            // –ï—Å–ª–∏ –∫–ª—é—á–µ–π –Ω–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ
            return generateAdminKeys();
        }

        // 3. –ü–æ–¥–ø–∏—Å—å Beacon –∞–¥–º–∏–Ω–∫–æ–π
        async function adminSignBeacon() {
            if (!adminKeyPair) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –∞–¥–º–∏–Ω–∫–∏', 'warning');
                return;
            }
            
            const beaconUrl = document.getElementById('admin-beacon-url').value.trim();
            const duration = parseInt(document.getElementById('signature-duration').value);
            
            if (!beaconUrl) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ URL Beacon', 'warning');
                return;
            }
            
            try {
                logProtocol(`[–ê–¥–º–∏–Ω–∫–∞] –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–¥–ø–∏—Å—å Beacon: ${beaconUrl}`, 'info');
                
                // 1. –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
                const timestamp = Date.now();
                const expires = duration > 0 ? timestamp + duration : 0;
                const signatureId = generateSignatureId();
                
                const dataToSign = {
                    beaconUrl: beaconUrl,
                    timestamp: timestamp,
                    expires: expires,
                    signatureId: signatureId,
                    adminPublicKey: nacl.util.encodeBase64(adminKeyPair.publicKey)
                };
                
                const dataString = JSON.stringify(dataToSign);
                
                // 2. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const signature = nacl.sign.detached(
                    nacl.util.decodeUTF8(dataString),
                    adminKeyPair.secretKey
                );
                
                const signatureBase64 = nacl.util.encodeBase64(signature);
                
                // 3. –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–¥–ø–∏—Å–∏
                const signedBeacon = {
                    ...dataToSign,
                    signature: signatureBase64,
                    signedData: dataString,
                    createdAt: timestamp,
                    status: 'active'
                };
                
                // 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                signedBeacons.set(beaconUrl, signedBeacon);
                saveSignedBeacons();
                
                // 5. –ü—É–±–ª–∏–∫—É–µ–º –≤ GunDB
                await publishSignatureToGunDB(signedBeacon);
                
                // 6. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å –Ω–∞ Beacon —á–µ—Ä–µ–∑ WebSocket
                await sendSignatureToBeacon(beaconUrl, signedBeacon);
                
                // 7. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const signatureOutput = document.getElementById('signature-output');
                const signatureResult = document.getElementById('signature-result');
                
                if (signatureOutput && signatureResult) {
                    signatureOutput.textContent = `–ü–æ–¥–ø–∏—Å—å: ${signatureBase64.substring(0, 60)}...`;
                    signatureResult.classList.remove('hidden');
                }
                
                logProtocol(`[–ê–¥–º–∏–Ω–∫–∞] Beacon —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–Ω! –ü–æ–¥–ø–∏—Å—å: ${signatureBase64.substring(0, 30)}...`, 'success');
                showNotification('‚úÖ Beacon —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–Ω!', 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ Beacon
                refreshBeaconsList();
                
            } catch (error) {
                logProtocol(`[–ê–¥–º–∏–Ω–∫–∞] –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Beacon: ${error.message}`, 'error');
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Beacon', 'error');
            }
        }

        // 4. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –≤ GunDB
        async function publishSignatureToGunDB(signedBeacon) {
            if (!gun) return;
            
            try {
                const beaconId = btoa(signedBeacon.beaconUrl).replace(/[^a-zA-Z0-9]/g, '_');
                
                // –ü—É–±–ª–∏–∫—É–µ–º –ø–æ–¥–ø–∏—Å—å
                gun.get(`${CONFIG.gunSignaturesPath}/${beaconId}`).put({
                    ...signedBeacon,
                    publishedAt: Date.now(),
                    publishedBy: 'admin'
                });
                
                // –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º Beacon –≤ —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö
                gun.get(`${CONFIG.gunBeaconPath}/signed/${beaconId}`).put({
                    url: signedBeacon.beaconUrl,
                    signature: signedBeacon.signature,
                    adminPublicKey: signedBeacon.adminPublicKey,
                    timestamp: signedBeacon.timestamp,
                    expires: signedBeacon.expires,
                    status: 'active'
                });
                
                logProtocol('[–ê–¥–º–∏–Ω–∫–∞] –ü–æ–¥–ø–∏—Å—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –≤ GunDB', 'success');
                return true;
                
            } catch (error) {
                logProtocol(`[–ê–¥–º–∏–Ω–∫–∞] –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ GunDB: ${error.message}`, 'warning');
                return false;
            }
        }

        // 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ Beacon —á–µ—Ä–µ–∑ WebSocket
        async function sendSignatureToBeacon(beaconUrl, signedBeacon) {
            logProtocol(`[–ê–¥–º–∏–Ω–∫–∞] –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ Beacon: ${beaconUrl}`, 'info');
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Beacon
            // –î–ª—è –¥–µ–º–æ –∏–º–∏—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
            
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // –ò–º–∏—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                    logProtocol('[–ê–¥–º–∏–Ω–∫–∞] –ü–æ–¥–ø–∏—Å—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ Beacon. Beacon –Ω–∞—á–∞–ª —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é —Å–µ—Ç–∏.', 'success');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å Beacon
                    updateBeaconStatus(beaconUrl, 'signed');
                    
                    resolve(true);
                }, 1000);
            });
        }

        // 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Beacon
        async function verifyBeaconSignature(beaconUrl) {
            logProtocol(`[–ü—Ä–æ–≤–µ—Ä–∫–∞] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Beacon: ${beaconUrl}`, 'info');
            
            updateStatus('signature', false, '–ü–æ–∏—Å–∫ –ø–æ–¥–ø–∏—Å–∏ –≤ GunDB...');
            
            try {
                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
                if (signedBeacons.has(beaconUrl)) {
                    const signedBeacon = signedBeacons.get(beaconUrl);
                    if (await verifySignatureObject(signedBeacon)) {
                        updateStatus('signature', true, '–ü–æ–¥–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (–ª–æ–∫–∞–ª—å–Ω–æ)');
                        return true;
                    }
                }
                
                // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ GunDB
                const beaconId = btoa(beaconUrl).replace(/[^a-zA-Z0-9]/g, '_');
                
                return new Promise((resolve) => {
                    gun.get(`${CONFIG.gunSignaturesPath}/${beaconId}`).once((signature) => {
                        if (signature && signature.signature && signature.adminPublicKey) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
                            if (signature.expires && Date.now() > signature.expires) {
                                logProtocol(`[–ü—Ä–æ–≤–µ—Ä–∫–∞] –ü–æ–¥–ø–∏—Å—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞`, 'warning');
                                updateStatus('signature', false, '–ü–æ–¥–ø–∏—Å—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞');
                                resolve(false);
                                return;
                            }
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å
                            if (verifySignatureObject(signature)) {
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                                signedBeacons.set(beaconUrl, signature);
                                saveSignedBeacons();
                                
                                updateStatus('signature', true, '–ü–æ–¥–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (GunDB)');
                                logProtocol('[–ü—Ä–æ–≤–µ—Ä–∫–∞] –ü–æ–¥–ø–∏—Å—å Beacon –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞', 'success');
                                resolve(true);
                            } else {
                                updateStatus('signature', false, '–ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å');
                                resolve(false);
                            }
                        } else {
                            logProtocol('[–ü—Ä–æ–≤–µ—Ä–∫–∞] –ü–æ–¥–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ GunDB', 'warning');
                            updateStatus('signature', false, '–ü–æ–¥–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                            resolve(false);
                        }
                    });
                });
                
            } catch (error) {
                logProtocol(`[–ü—Ä–æ–≤–µ—Ä–∫–∞] –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏: ${error.message}`, 'error');
                updateStatus('signature', false, '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏');
                return false;
            }
        }

        // 7. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞ –ø–æ–¥–ø–∏—Å–∏
        function verifySignatureObject(signature) {
            try {
                const publicKey = nacl.util.decodeBase64(signature.adminPublicKey);
                const signatureBytes = nacl.util.decodeBase64(signature.signature);
                const message = nacl.util.decodeUTF8(signature.signedData || JSON.stringify({
                    beaconUrl: signature.beaconUrl,
                    timestamp: signature.timestamp,
                    expires: signature.expires,
                    signatureId: signature.signatureId,
                    adminPublicKey: signature.adminPublicKey
                }));
                
                return nacl.sign.detached.verify(message, signatureBytes, publicKey);
            } catch (error) {
                console.error('Signature verification error:', error);
                return false;
            }
        }

        // =================== –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ú–ï–•–ê–ù–ò–ó–ú –†–£–ö–û–ü–û–ñ–ê–¢–ò–Ø ===================
        async function startHandshake() {
            if (!validateCurrentURL()) {
                showError('–ù–µ–≤–µ—Ä–Ω—ã–π URL Beacon. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ.');
                return;
            }
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            resetConnectionState();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            const handshakeBtn = document.getElementById('handshake-btn');
            handshakeBtn.disabled = true;
            handshakeBtn.innerHTML = '<span class="spinner">‚ü≥</span> –†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ...';
            
            logProtocol(`[–°–∏—Å—Ç–µ–º–∞] –ù–∞—á–∏–Ω–∞–µ–º —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ —Å Beacon: ${currentBeaconURL}`, 'info');
            
            try {
                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å Beacon
                updateStatus('signature', false, '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∞–¥–º–∏–Ω–∫–∏...');
                
                const isSigned = await verifyBeaconSignature(currentBeaconURL);
                if (!isSigned) {
                    throw new Error('Beacon –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –∞–¥–º–∏–Ω–∫–æ–π. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ.');
                }
                
                connectionState.signatureVerified = true;
                logProtocol('[–°–∏—Å—Ç–µ–º–∞] –ü–æ–¥–ø–∏—Å—å Beacon –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞', 'success');
                
                // 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è
                updateStatus('handshake', false, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                
                const handshakeData = {
                    sessionId: sessionId,
                    beaconUrl: currentBeaconURL,
                    timestamp: Date.now(),
                    version: '3.0',
                    protocol: 'ed25519',
                    signatureVerified: true
                };
                
                // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
                updateStatus('handshake', false, '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Beacon...');
                logProtocol(`[–°–∏—Å—Ç–µ–º–∞] –û—Ç–ø—Ä–∞–≤–∫–∞ handshake –∑–∞–ø—Ä–æ—Å–∞...`, 'info');
                
                const response = await performHandshakeRequest(currentBeaconURL, handshakeData);
                
                // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
                updateStatus('handshake', true, '–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                connectionState.handshakeCompleted = true;
                logProtocol(`[–°–∏—Å—Ç–µ–º–∞] –†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ —É—Å–ø–µ—à–Ω–æ. –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω.`, 'success');
                
                // 5. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏
                await connectToNetwork(response);
                
                // –£—Å–ø–µ—Ö
                showSuccess(response);
                
            } catch (error) {
                handleHandshakeError(error);
            } finally {
                handshakeBtn.disabled = false;
                handshakeBtn.innerHTML = 'üîÑ –ù–∞—á–∞—Ç—å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ';
            }
        }

        // =================== GUNDB –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø) ===================
        function initializeGunDB() {
            try {
                if (gun) return;
                
                gun = Gun(CONFIG.gunPeers);
                
                // –°–ª—É—à–∞–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ Beacon
                gun.get(`${CONFIG.gunBeaconPath}/signed`).map().on((beacon, id) => {
                    if (beacon && beacon.url) {
                        logProtocol(`[GunDB] –û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π Beacon: ${shortenURL(beacon.url)}`, 'info');
                        updateBeaconOnMap(beacon, id);
                    }
                });
                
                // –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –∞–¥–º–∏–Ω–∫–∏
                gun.get(CONFIG.gunAdminKeysPath).on((keys) => {
                    if (keys && keys.publicKey) {
                        logProtocol('[GunDB] –ü–æ–ª—É—á–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∞–¥–º–∏–Ω–∫–∏', 'info');
                    }
                });
                
                logProtocol('GunDB –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö Beacon', 'success');
                
            } catch (error) {
                logProtocol(`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ GunDB: ${error.message}`, 'error');
            }
        }

        // =================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===================
        function generateSignatureId() {
            return 'sig_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function saveSignedBeacons() {
            const beaconsArray = Array.from(signedBeacons.entries());
            localStorage.setItem('shadowgrid_signed_beacons', JSON.stringify(beaconsArray));
        }

        function loadSignedBeacons() {
            try {
                const saved = localStorage.getItem('shadowgrid_signed_beacons');
                if (saved) {
                    const beaconsArray = JSON.parse(saved);
                    signedBeacons = new Map(beaconsArray);
                    logProtocol(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${signedBeacons.size} –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö Beacon`, 'info');
                }
            } catch (error) {
                console.error('Error loading signed beacons:', error);
            }
        }

        function updateAdminKeysDisplay() {
            if (!adminKeyPair) return;
            
            const publicKeyElement = document.getElementById('admin-public-key');
            const privateKeyElement = document.getElementById('admin-private-key');
            
            if (publicKeyElement) {
                const publicKeyBase64 = nacl.util.encodeBase64(adminKeyPair.publicKey);
                publicKeyElement.textContent = `${publicKeyBase64.substring(0, 30)}...`;
                publicKeyElement.title = publicKeyBase64;
            }
            
            if (privateKeyElement) {
                const privateKeyBase64 = nacl.util.encodeBase64(adminKeyPair.secretKey);
                privateKeyElement.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                privateKeyElement.title = privateKeyBase64;
                privateKeyElement.dataset.key = privateKeyBase64;
            }
        }

        function refreshBeaconsList() {
            const listElement = document.getElementById('signed-beacons-list');
            if (!listElement) return;
            
            listElement.innerHTML = '';
            
            signedBeacons.forEach((beacon, url) => {
                const item = document.createElement('div');
                item.style.cssText = `
                    padding: 0.5rem;
                    background: rgba(0,0,0,0.3);
                    border-radius: 4px;
                    margin-bottom: 0.5rem;
                    border-left: 3px solid var(--accent-green);
                `;
                
                const expiresText = beacon.expires ? 
                    new Date(beacon.expires).toLocaleString() : '–ë–µ—Å—Å—Ä–æ—á–Ω–æ';
                
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between;">
                        <div style="font-weight: bold; color: var(--primary);">${shortenURL(url, 30)}</div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary);">${beacon.status || 'active'}</div>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary);">
                        –ü–æ–¥–ø–∏—Å–∞–Ω–æ: ${new Date(beacon.timestamp).toLocaleString()}<br>
                        –ò—Å—Ç–µ–∫–∞–µ—Ç: ${expiresText}
                    </div>
                `;
                
                listElement.appendChild(item);
            });
            
            if (signedBeacons.size === 0) {
                listElement.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 1rem;">–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö Beacon</div>';
            }
        }

        // =================== –ò–ù–¢–ï–†–§–ï–ô–° –ê–î–ú–ò–ù–ö–ò ===================
        function showAdminPanel() {
            document.getElementById('admin-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            refreshBeaconsList();
        }

        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                btn.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                btn.style.color = 'var(--text-secondary)';
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const tabButton = document.getElementById(`tab-${tabName}`);
            const tabContent = document.getElementById(`tab-${tabName}-content`);
            
            if (tabButton && tabContent) {
                tabButton.classList.add('active');
                tabButton.style.borderBottom = '2px solid var(--primary)';
                tabButton.style.color = 'var(--primary)';
                tabContent.classList.remove('hidden');
            }
        }

        // =================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ ===================
        function initializeSystem() {
            logProtocol('[–°–∏—Å—Ç–µ–º–∞] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ShadowGrid Beacon v3.0', 'info');
            
            // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª—é—á–∏ –∞–¥–º–∏–Ω–∫–∏
            loadAdminKeys();
            
            // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ Beacon
            loadSignedBeacons();
            
            // 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π Beacon URL
            currentBeaconURL = CONFIG.defaultBeaconURL;
            document.getElementById('beacon-url-input').value = currentBeaconURL;
            updateStatus('url', true, `URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${shortenURL(currentBeaconURL)}`);
            enableHandshakeButton();
            
            // 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º GunDB
            initializeGunDB();
            
            // 5. –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É
            initializeMap();
            
            // 6. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats();
            
            logProtocol('[–°–∏—Å—Ç–µ–º–∞] –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é.', 'info');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∫–∏
            setTimeout(() => {
                document.getElementById('admin-tools').classList.remove('hidden');
            }, 2000);
        }

        // =================== –û–ë–ù–û–í–õ–ï–ù–ù–´–ô USE_DETECTED_BEACON ===================
        function useDetectedBeacon() {
            logProtocol('[–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ] –ü–æ–∏—Å–∫ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö Beacon –≤ GunDB...', 'info');
            
            updateStatus('url', false, '–ü–æ–∏—Å–∫ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö Beacon...');
            
            if (!gun) {
                logProtocol('GunDB –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'warning');
                return;
            }
            
            // –ò—â–µ–º –¢–û–õ–¨–ö–û –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ Beacon
            gun.get(`${CONFIG.gunBeaconPath}/signed`).map().once((beacon, id) => {
                if (beacon && beacon.url && beacon.signature) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
                    if (beacon.expires && Date.now() > beacon.expires) {
                        logProtocol(`Beacon –ø—Ä–æ—Å—Ä–æ—á–µ–Ω: ${shortenURL(beacon.url)}`, 'warning');
                        return;
                    }
                    
                    currentBeaconURL = beacon.url;
                    document.getElementById('beacon-url-input').value = beacon.url;
                    saveBeaconURL(beacon.url);
                    
                    updateStatus('url', true, `–ù–∞–π–¥–µ–Ω –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π Beacon: ${shortenURL(beacon.url)}`);
                    enableHandshakeButton();
                    logProtocol(`–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π Beacon –æ–±–Ω–∞—Ä—É–∂–µ–Ω: ${beacon.url}`, 'success');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É
                    updateBeaconStatus(beacon.url, 'signed');
                }
            });
            
            setTimeout(() => {
                if (!currentBeaconURL) {
                    logProtocol('–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ Beacon –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥–º–∏–Ω–∫—É –¥–ª—è –ø–æ–¥–ø–∏—Å–∏.', 'warning');
                    updateStatus('url', false, '–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ Beacon –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                }
            }, 3000);
        }

        // =================== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–ê–†–¢–ê ===================
        function initializeMap() {
            const container = document.getElementById('map-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            // –û—Å–Ω–æ–≤–Ω–æ–π Beacon
            const mainBeacon = {
                lat: 35.6762,
                lon: 139.6503,
                url: CONFIG.defaultBeaconURL,
                status: signedBeacons.has(CONFIG.defaultBeaconURL) ? 'signed' : 'pending'
            };
            
            const beacons = [
                { lat: 55.7558, lon: 37.6173, status: 'active', url: 'wss://beacon-moscow.shadowgrid.net' },
                { lat: 48.8566, lon: 2.3522, status: 'active', url: 'wss://beacon-paris.shadowgrid.net' },
                { lat: 40.7128, lon: -74.0060, status: 'active', url: 'wss://beacon-ny.shadowgrid.net' },
                mainBeacon,
                { lat: 1.3521, lon: 103.8198, status: 'pending', url: 'wss://beacon-sg.shadowgrid.net' }
            ];
            
            const width = container.offsetWidth;
            const height = container.offsetHeight;
            
            beacons.forEach((beacon) => {
                const x = (beacon.lon + 180) * (width / 360);
                const y = (90 - beacon.lat) * (height / 180);
                
                const dot = document.createElement('div');
                dot.className = 'node-point';
                
                // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
                let color = 'var(--accent-orange)';
                let shadow = '0 0 6px var(--accent-orange)';
                
                if (beacon.url === currentBeaconURL) {
                    color = 'var(--accent-green)';
                    shadow = '0 0 10px var(--accent-green)';
                } else if (beacon.status === 'signed') {
                    color = 'var(--secondary)';
                    shadow = '0 0 8px var(--secondary)';
                } else if (beacon.status === 'active') {
                    color = 'var(--accent-blue)';
                    shadow = '0 0 8px var(--accent-blue)';
                }
                
                dot.style.background = color;
                dot.style.boxShadow = shadow;
                dot.title = `Beacon: ${shortenURL(beacon.url)}\n–°—Ç–∞—Ç—É—Å: ${beacon.status}`;
                dot.style.left = `${x}px`;
                dot.style.top = `${y}px`;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ Beacon
                if (beacon.url === currentBeaconURL) {
                    dot.classList.add('pulse');
                }
                
                container.appendChild(dot);
            });
        }

        // =================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ===================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ ShadowGrid Beacon v3.0 - –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–∏ Beacon');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É
            initializeSystem();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            window.addEventListener('resize', initializeMap);
            document.getElementById('beacon-url-input').addEventListener('input', validateCurrentURL);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(updateStats, 10000);
        });

        // =================== –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ===================
        // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (validateCurrentURL, showSuccess, showError –∏ —Ç.–¥.)
        // –æ—Å—Ç–∞—é—Ç—Å—è –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô, –∫–∞–∫ –≤ –≤–∞—à–µ–º –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
        // –Ø –Ω–µ –±—É–¥—É –∏—Ö –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∑–¥–µ—Å—å –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
        
        // –í–æ—Ç —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –∫–∞–∫ –µ—Å—Ç—å:
        // - loadBeaconFromURL()
        // - loadBeaconFromStorage()
        // - saveBeaconURL()
        // - clearBeaconURL()
        // - validateCurrentURL()
        // - performHandshakeRequest()
        // - connectToNetwork()
        // - updateStatus()
        // - enableHandshakeButton()
        // - disableHandshakeButton()
        // - showSuccess()
        // - showError()
        // - handleHandshakeError()
        // - resetConnectionState()
        // - generateSessionId()
        // - isValidURL()
        // - shortenURL()
        // - logProtocol()
        // - delay()
        // - scrollToBeacon()
        // - showQRCode()
        // - retryConnection()
        // - showDebugInfo()
        // - testConnection()
        // - closeModal()
        // - updateStats()
        // - updateBeaconOnMap()
        // - updateBeaconStatus()
        // - showNotification()
        // - copyToClipboard()
        // - exportAdminKeys()
        // - importAdminKeys()
        // - revokeBeaconSignature()
        
    </script>
</body>
</html>
